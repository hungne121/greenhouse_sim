# ==============================================================
# CẤU HÌNH HÌNH DÁNG ROBOT (Quan trọng để không bị kẹt)
# ==============================================================

# Pepper có đường kính đế khoảng 48cm -> Bán kính 0.24m. 
# Ta để 0.25m cho dư dả một chút.
robot_radius: 0.25

# Khoảng đệm an toàn vô hình sát người robot (cm)
footprint_padding: 0.01

# Chấp nhận độ trễ của TF (để tránh lỗi "Transform failed" cũ)
transform_tolerance: 0.5

# ==============================================================
# CẤU HÌNH LỚP VẬT CẢN (Obstacle Layer) - "Mắt" của robot
# ==============================================================
obstacle_layer:
  enabled: true
  
  # Chỉ tin vật cản trong bán kính 2.5m (xa hơn thì coi như chưa thấy)
  obstacle_range: 2.5
  
  # Xóa vật cản nếu quét thấy khoảng trống trong 3.0m
  # (Giúp xóa bóng ma vật cản cũ khi vật đó đã bị dời đi)
  raytrace_range: 3.0
  
  # Nguồn dữ liệu
  observation_sources: scan
  
  scan:
    data_type: LaserScan
    topic: /scan
    marking: true
    clearing: true
    
    # --- XỬ LÝ LỖI QUÉT TRÚNG TAY (QUAN TRỌNG) ---
    # Tay Pepper khá dài, cần tăng lên 0.65m để loại bỏ hoàn toàn việc tự nhìn thấy tay mình.
    min_obstacle_range: 0.65
    
    # --- XỬ LÝ NHIỄU CHIỀU CAO ---
    # Tăng lên 0.08m để tránh quét trúng sàn nhà khi robot di chuyển (rung lắc)
    min_obstacle_height: 0.08
    max_obstacle_height: 2.0
    
    # Nếu dùng Gazebo Lidar bị lỗi Inf (vô cực), dòng này giúp fix lỗi đó
    inf_is_valid: true

# ==============================================================
# CẤU HÌNH LỚP AN TOÀN (Inflation Layer) - "Vùng cấm"
# ==============================================================
inflation_layer:
  enabled: true
  
  # Bán kính ảnh hưởng (để Global Planner né từ xa)
  inflation_radius: 0.7
  
  # --- CHÌA KHÓA CHO ĐƯỜNG HẸP ---
  # Tăng số này lên (5.0 -> 10.0) để vùng nguy hiểm "co lại" sát tường hơn.
  # Giúp robot dám đi qua cửa hẹp mà không báo lỗi kẹt.
  cost_scaling_factor: 8.0
